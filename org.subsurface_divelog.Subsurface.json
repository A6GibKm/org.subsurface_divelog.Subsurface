{
	"app-id": "org.subsurface_divelog.Subsurface",
	"runtime": "org.kde.Platform",
	"runtime-version": "5.9",
	"sdk": "org.kde.Sdk",
	"command": "subsurface",
	"rename-icon": "subsurface-icon",
	"rename-appdata-file": "subsurface.appdata.xml",
	"rename-desktop-file": "subsurface.desktop",
	"desktop-file-name-suffix": "-test",
	"finish-args":[
		"--socket=wayland",
		"--socket=x11",
		"--share=network",
		"--filesystem=home",
		"--device=all",
		"--env=QTWEBENGINE_DISABLE_SANDBOX=1",
		"--env=QT_QPA_PLATFORM=flatpak"
	],
	"build-options": {
		"cflags": "-O2",
		"cxxflags": "-O2"
	},
	"cleanup": [
		"/include",
		"/lib/pkgconfig",
		"/lib64/pkgconfig",
		"/lib/cmake",
		"/share/doc",
		"/share/man",
		"*.a",
		"*.la",
		"*.cmake"
	],
	"modules":[
		{
			"name": "qtwebkit",
			"cleanup-platform": [
				"/bin",
				"/mkspecs"
			],
			"sources": [
				{
					"type": "git",
					"url": "git://github.com/qt/qtwebkit",
					"branch": "v5.212.0-alpha2",
					"commit": "aab669a05f943c587f6acccd94d53a8544170c1c"
				 },
                {
                    "type": "script",
                    "commands": [ "qmake" ],
                    "dest-filename": "configure"
                }
			]
		},
		"shared-modules/udev/udev-175.json",
		{
			"name":"libssh2",
			"buildsystem":"cmake",
			"config-opts":[
				"-DCMAKE_INSTALL_LIBDIR=/app/lib",
				"-DCMAKE_C_FLAGS=-fPIC"
			],
			"sources":[
				{
					"type":"git",
					"url":"https://github.com/libssh2/libssh2.git",
					"branch": "libssh2-1.8.0",
					"commit": "72274af7f901315c1d47e43620c5bcb5f40c2b20"
				}
			]
		},
		{
			"name":"libzip",
			"sources":[
				{
					"type":"git",
					"url":"https://github.com/nih-at/libzip.git",
					"branch": "rel-1-2-0",
					"commit": "a23ac8a766c556827255111eb35ba928641efbc8"
				},
				{
					"type":"script",
					"commands":["autoreconf -vfi"],
					"dest-filename": "autogen.sh"
				}
			]
		},
		{
			"name":"googlemaps",
			"buildsystem": "simple",
			"sources":[
				{
					"type":"git",
					"url":"https://github.com/Subsurface-divelog/googlemaps.git",
					"commit": "e6b44ec91c2c7275142bb6b8afa90a3c6c76fd13"
				}
			],
			"build-commands": [
				"mkdir build",
				"cd build && \\
				qmake PREFIX=/app ../googlemaps.pro && \\
				sed -i \"s|(INSTALL_ROOT)/usr|//app|\" Makefile && \\
				sed -i 's/std=c++1z/std=c++11/g ; s/-Wdate-time//' Makefile && \\
				make -j4 && \\
				make install"
			]
		},
		{
			"name": "subsurface",
			"buildsystem":"simple",
			"sources":[
				{
					"type":"git",
					"url": "https://github.com/Subsurface-divelog/subsurface.git",
					"commit": "58b7c6f8ef703009e098351774b8db521cce48e3",
					"dest": "subsurface"
				},
				{
					"type":"git",
					"url":"https://github.com/libgit2/libgit2.git",
					"branch": "v0.26.0",
					"commit": "15e119375018fba121cf58e02a9f17fe22df0df8",
					"dest": "libgit2"
				},
				{
					"type":"git",
					"url":"https://github.com/Subsurface-divelog/libdc.git",
					"branch": "v4.6.4",
					"commit": "82c7bc82aa1ff5110b3f8dd8a0a31581a1fb085c",
					"dest": "libdivecomputer"
				},
				{
					"type":"git",
					"url":"https://github.com/steveire/grantlee.git",
					"branch": "v5.1.0",
					"commit": "8f66fa86a24775e245df560771f313fa59770096",
					"dest": "grantlee"
				}
			],
			"build-commands":
			[
				"mkdir -p /app/share/metainfo && cp ./subsurface/appdata/subsurface.appdata.xml /app/share/metainfo",
				"sed -i \"s,INSTALL_ROOT=.*,INSTALL_ROOT=/app,\" ./subsurface/scripts/build.sh",
				"sed -i \"s,cmake -DCMAKE_BUILD_TYPE=Debug.*,cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/app .. \\\\\\\\,\" ./subsurface/scripts/build.sh",
				"sed -i \"s,\\\$PRINTING \\\$EXTRA_OPTS,-DNO_PRINTING=OFF \\\$EXTRA_OPTS,\" ./subsurface/scripts/build.sh",
				"./subsurface/scripts/build.sh -build-with-webkit -desktop",
				"cd subsurface/build && make install"
			]
		}
	]
}
